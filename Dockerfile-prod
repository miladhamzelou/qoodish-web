FROM node:8.9.1

RUN mkdir /qoodish-web
WORKDIR /qoodish-web
ADD . /qoodish-web

ARG AWS_REGION
ARG AWS_ACCESS_KEY
ARG AWS_SECRET_KEY
ARG SLACK_WEBHOOK
ARG SLACK_CHANNEL
ARG S3_BUCKET_ASSETS

ARG ENDPOINT
ARG SUBSTITUTE_URL
ARG FB_APP_ID

ARG FIREBASE_API_KEY
ARG FIREBASE_AUTH_DOMAIN
ARG FIREBASE_DB_URL
ARG FIREBASE_STORAGE_BUCKET
ARG FIREBASE_MESSAGING_SENDER_ID
ARG FIREBASE_IMAGE_BUCKET
ARG PICKED_UP_MAP_ID

ENV AWS_REGION $AWS_REGION
ENV AWS_ACCESS_KEY $AWS_ACCESS_KEY
ENV AWS_SECRET_KEY $AWS_SECRET_KEY
ENV SLACK_WEBHOOK $SLACK_WEBHOOK
ENV SLACK_CHANNEL $SLACK_CHANNEL
ENV S3_BUCKET_ASSETS $S3_BUCKET_ASSETS

ENV ENDPOINT $ENDPOINT
ENV SUBSTITUTE_URL $SUBSTITUTE_URL
ENV FB_APP_ID $FB_APP_ID

ENV FIREBASE_API_KEY $FIREBASE_API_KEY
ENV FIREBASE_AUTH_DOMAIN $FIREBASE_AUTH_DOMAIN
ENV FIREBASE_DB_URL $FIREBASE_DB_URL
ENV FIREBASE_STORAGE_BUCKET $FIREBASE_STORAGE_BUCKET
ENV FIREBASE_MESSAGING_SENDER_ID $FIREBASE_MESSAGING_SENDER_ID
ENV FIREBASE_IMAGE_BUCKET $FIREBASE_IMAGE_BUCKET
ENV PICKED_UP_MAP_ID $PICKED_UP_MAP_ID

RUN yarn
RUN yarn build:prod
RUN yarn upload
